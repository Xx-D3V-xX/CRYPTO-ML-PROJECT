name: Always Run EDA Notebook

permissions:
  contents: write

on:
  push: {}

jobs:
  eda:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          lfs: true
          persist-credentials: true

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.13'

      - name: Install dependencies
        run: |
          pip install \
            papermill \
            pandas seaborn missingno matplotlib \
            ipykernel ipython-autotime

      - name: Register Jupyter kernel
        run: |
          python -m ipykernel install \
            --sys-prefix \
            --name python3 \
            --display-name python3

      - name: Execute EDA & Preprocessing
        run: |
          mkdir -p reports data/interim
          papermill \
            notebooks/1_eda_preprocessing.ipynb \
            reports/1_eda_preprocessing_output.ipynb \
            -p DATA_RAW     data/raw \
            -p DATA_INTERIM data/interim \
            --log-output

      - name: Commit & Push EDA outputs
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          branch: ${{ github.ref_name }}
          commit_message: "ci: update EDA report & interim data"
          file_pattern: |
            data/interim/*.csv
            reports/1_eda_preprocessing_output.ipynb